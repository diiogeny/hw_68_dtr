{% extends "base.html" %}
{% block title %}{{ article.title }}{% endblock %}

{% block menu %}
    {% if perms.webapp.change_article or request.user == article.author %}
        <li class="nav-item">
            <a class="nav-link" href="{% url 'webapp:article_update' article.id %}">–ò–∑–º–µ–Ω–∏—Ç—å</a>
        </li>
    {% endif %}

    {% if perms.webapp.delete_article or request.user == article.author %}
        <li class="nav-item">
            <a class="nav-link" href="{% url 'webapp:article_delete' article.id %}">–£–¥–∞–ª–∏—Ç—å</a>
        </li>
    {% endif %}
    {% if request.user.is_authenticated %}
        <li class="nav-item">
            <a class="nav-link" href="{% url 'webapp:comment_add' article.id %}">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</a>
        </li>
    {% endif %}
{% endblock %}

{% block content %}
    <div class="card">
        <div class="card-header">
            –ê–≤—Ç–æ—Ä: {{ article.author }}
        </div>
        <div class="card-body">
            <h5 class="card-title">{{ article.title }}</h5>
            <p class="card-text">{{ article.content }}</p>

            {% if article.tags.exists %}
                <p class="card-text">
                    –¢–µ–≥–∏:
                    {% for tag in article.tags.all %}
                        {{ tag.name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </p>
            {% endif %}

            <a href="{% url 'webapp:article_test' article.pk %}" class="btn btn-primary article_link">–¢–µ—Å—Ç</a>
        </div>
    </div>

        <div>
    <button class="like-btn btn {% if user in article.likes.all %}btn-success{% else %}btn-outline-success{% endif %}"
            data-url="{% url 'webapp:article_like' article.pk %}">
        ‚ù§Ô∏è <span class="counter">{{ article.likes.count }}</span>
    </button>

    <button class="dislike-btn btn {% if user in article.dislikes.all %}btn-danger{% else %}btn-outline-danger{% endif %}"
            data-url="{% url 'webapp:article_dislike' article.pk %}">
        üëé <span class="counter">{{ article.dislikes.count }}</span>
    </button>
</div>

    <h3 class="mt-3">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</h3>
    <div class="row">
        {% for comment in comments %}
            <div class="col-12">
                <div class="card my-2">
                    <div class="card-body">
                        <h5 class="card-title">–ê–≤—Ç–æ—Ä: {{ comment.author }}</h5>
                        <p class="card-text">{{ comment.text }}</p>

                        {% if perms.webapp.change_comment or request.user == comment.author %}
                            <a href="{% url 'webapp:comment_update' comment.pk %}" class="btn btn-primary">–ò–∑–º–µ–Ω–∏—Ç—å</a>
                        {% endif %}

                        {% if perms.webapp.delete_comment or request.user == comment.author %}
                            <a href="{% url 'webapp:comment_delete' comment.pk %}" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% empty %}
            <p>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–µ—Ç</p>
        {% endfor %}
    </div>
{% endblock %}
